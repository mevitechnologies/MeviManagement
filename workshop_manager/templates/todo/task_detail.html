{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block content %}

<style>
  .task-header {
    background: linear-gradient(90deg, #007bff, #00c4ff);
    color: white;
    border-radius: 10px;
    padding: 20px;
  }

  .task-card {
    border-radius: 10px;
    background: #ffffff;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .progress {
    height: 10px;
    border-radius: 5px;
  }

  .subtask-item {
    transition: 0.3s;
  }

  .subtask-item:hover {
    background-color: #f8f9fa;
  }

  .btn-sm i {
    font-size: 1rem;
  }
</style>

<div class="container mt-4 mb-5">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="fw-bold text-primary">
      <i class="bi bi-list-task"></i> Task Details
    </h4>
    <a href="{% url 'admin_task_dashboard' %}" class="btn btn-outline-secondary btn-sm">
      <i class="bi bi-arrow-left"></i> Back to Dashboard
    </a>
  </div>

  <!-- Task Summary -->
  <div class="task-card mb-4 p-4">
    <div class="row">
      <div class="col-md-8">
        <h4 class="fw-bold text-dark">{{ task.task }}</h4>
        <p class="text-muted mb-2">{{ task.description|default:"No description provided." }}</p>

        <div class="d-flex flex-wrap gap-3 mb-2">
          <span class="badge 
            {% if task.priority == 'high' %}bg-danger
            {% elif task.priority == 'medium' %}bg-warning text-dark
            {% else %}bg-success{% endif %}">
            <i class="bi bi-lightning-fill"></i> {{ task.get_priority_display }}
          </span>

          <span class="badge bg-info text-dark">
            <i class="bi bi-calendar3"></i> {{ task.for_date }}
          </span>

          {% if task.estimated_hours %}
          <span class="badge bg-secondary">
            <i class="bi bi-clock"></i> {{ task.estimated_hours }} hrs
          </span>
          {% endif %}

          <span class="badge bg-primary">
            <i class="bi bi-person-circle"></i> {{ task.trainer.Name }}
          </span>
        </div>

        <div class="mt-3">
          {% if task.total_subtasks > 0 %}
          <p class="mb-1 small text-muted">Progress</p>
          <div class="progress">
            <div class="progress-bar 
              {% if task.progress == 100 %}bg-success
              {% elif task.progress > 50 %}bg-info
              {% else %}bg-warning{% endif %}" 
              role="progressbar" style="width: {{ task.progress }}%">
            </div>
          </div>
          <small class="text-muted">
            {{ task.completed_subtasks }}/{{ task.total_subtasks }} subtasks done ({{ task.progress }}%)
          </small>
          {% else %}
          <small class="text-muted">No subtasks yet.</small>
          {% endif %}
        </div>
      </div>

      <div class="col-md-4 text-end">
        <a href="{% url 'add_subtask' task.id %}" class="btn btn-outline-secondary btn-sm me-2">
          <i class="bi bi-node-plus"></i> Add Subtask
        </a>
        <a href="{% url 'delete_task' task.id %}" class="btn btn-outline-danger btn-sm"
           onclick="return confirm('Are you sure you want to delete this task?');">
          <i class="bi bi-trash"></i> Delete
        </a>
      </div>
    </div>
  </div>

  <!-- Subtasks -->
  <div class="card border-0 shadow-sm">
    <div class="card-header bg-light fw-semibold">
      <i class="bi bi-check2-square"></i> Subtasks
    </div>
    <div class="card-body">
      {% if subtasks %}
        <ul class="list-group list-group-flush">
          {% for sub in subtasks %}
          <li class="list-group-item d-flex justify-content-between align-items-center subtask-item">
            <div>
              {% if sub.is_completed %}
                <i class="bi bi-check-circle-fill text-success"></i>
                <del class="text-muted">{{ sub.title }}</del>
              {% else %}
                <i class="bi bi-circle text-secondary"></i>
                {{ sub.title }}
              {% endif %}
            </div>

            <div>
              <a href="{% url 'toggle_subtask_done' task.id sub.id %}" 
                 class="btn btn-sm {% if sub.is_completed %}btn-outline-secondary{% else %}btn-outline-success{% endif %}">
                {% if sub.is_completed %}
                  <i class="bi bi-arrow-counterclockwise"></i> Undo
                {% else %}
                  <i class="bi bi-check2-circle"></i> Mark Done
                {% endif %}
              </a>
            </div>
          </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted mb-0">No subtasks added yet.</p>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
