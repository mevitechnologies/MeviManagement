{% extends 'base.html' %}
{% load static %}
{% block content %}

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>

<div class="container mt-4">

  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>ğŸ¢ Office Trainings</h3>
    {% if is_admin %}
      <a href="{% url 'add_office_training' %}" class="btn btn-success">+ Add Training</a>
    {% endif %}
  </div>

  <!-- TRAINING SECTIONS -->
  <div class="row">

    <!-- ONGOING -->
    <div class="col-md-4">
      <h5 class="text-success">ğŸŸ¢ Ongoing</h5>
      {% for t in ongoing %}
        <div class="border-start border-4 border-success ps-2 mb-2">
          <strong>{{ t.name }}</strong><br>
          <small>{{ t.start_date }} â†’ {{ t.end_date }}</small><br>
          <a href="{% url 'view_office_training' t.pk %}" class="btn btn-sm btn-outline-primary mt-1">View</a>
        </div>
      {% empty %}
        <p class="text-muted">No ongoing trainings</p>
      {% endfor %}
    </div>

    <!-- SCHEDULED -->
    <div class="col-md-4">
      <h5 class="text-primary">ğŸ“… Scheduled</h5>
      {% for t in scheduled %}
        <div class="border-start border-4 border-primary ps-2 mb-2">
          <strong>{{ t.name }}</strong><br>
          <small>Starts on {{ t.start_date }}</small><br>
          <a href="{% url 'view_office_training' t.pk %}" class="btn btn-sm btn-outline-primary mt-1">View</a>
        </div>
      {% empty %}
        <p class="text-muted">No upcoming trainings</p>
      {% endfor %}
    </div>

    <!-- PAST -->
    <div class="col-md-4">
      <h5 class="text-secondary">ğŸ“ Past</h5>
      {% for t in past %}
        <div class="border-start border-4 border-secondary ps-2 mb-2">
          <strong>{{ t.name }}</strong><br>
          <small>Ended on {{ t.end_date }}</small><br>
          <a href="{% url 'view_office_training' t.pk %}" class="btn btn-sm btn-outline-primary mt-1">View</a>
        </div>
      {% empty %}
        <p class="text-muted">No past trainings</p>
      {% endfor %}
    </div>

  </div>

  <!-- CALENDAR -->
  <div class="card shadow-sm mt-5">
    <div class="card-header bg-dark text-white fw-bold">
      ğŸ“† Office Training Calendar
    </div>
    <div class="card-body">
      <div id="office-training-calendar"></div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const calendarEl = document.getElementById('office-training-calendar');

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    height: 600,
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,listMonth'
    },
    events: [
      {% for t in calendar_trainings %}
      {
        title: "{{ t.name|escapejs }}",
        start: "{{ t.start_date|date:'Y-m-d' }}",
        end: "{{ t.end_date|date:'Y-m-d' }}",
        color:
          "{% if t.start_date > today %}#0d6efd{% elif t.end_date >= today and t.start_date <= today %}#198754{% else %}#6c757d{% endif %}",
        url: "{% url 'view_office_training' t.pk %}"
      },
      {% endfor %}
    ],
    eventClick(info) {
      if (info.event.url) {
        window.location.href = info.event.url;
        info.jsEvent.preventDefault();
      }
    }
  });

  calendar.render();
});
</script>

{% endblock %}
